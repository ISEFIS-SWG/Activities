{"ast":null,"code":"import _regeneratorRuntime from\"/Users/pratyas/Documents/MobileAppProject/MymobileApp/TOTRun/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/pratyas/Documents/MobileAppProject/MymobileApp/TOTRun/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/pratyas/Documents/MobileAppProject/MymobileApp/TOTRun/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from'react';import{Plugins}from\"@capacitor/core\";import{IonPage,IonHeader,IonToolbar,IonButton,IonContent,IonLoading,useIonViewDidEnter}from'@ionic/react';import shareValue from\"../Models/share\";var Geolocation=Plugins.Geolocation;var Tab3=function Tab3(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),showLoading=_useState2[0],setShowLoading=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),positionReady=_useState4[0],setPositionReady=_useState4[1];var _useState5=useState({lat:0,lng:0}),_useState6=_slicedToArray(_useState5,2),currentPosition=_useState6[0],setCurrentPosition=_useState6[1];var _useState7=useState({lat:0,lng:0,time:0}),_useState8=_slicedToArray(_useState7,2),startPosition=_useState8[0],setStartPosition=_useState8[1];var _useState9=useState({stime:0,ftime:0}),_useState10=_slicedToArray(_useState9,2),timeStatus=_useState10[0],setTimeStatus=_useState10[1];var _useState11=useState(0),_useState12=_slicedToArray(_useState11,2),totalDistance=_useState12[0],setTotalDistance=_useState12[1];var _useState13=useState(0),_useState14=_slicedToArray(_useState13,2),watchID=_useState14[0],setWatchID=_useState14[1];useIonViewDidEnter(function(){startGetGPS();});var position1;var startGetGPS=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var position1;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log('**** startGetGPS ***');setShowLoading(false);_context.next=4;return Geolocation.getCurrentPosition().then(success).catch(function(error){alert('Not found Position:'+error.message);});case 4:position1=_context.sent;case 5:case\"end\":return _context.stop();}}},_callee);}));return function startGetGPS(){return _ref.apply(this,arguments);};}();var success=function success(position){setShowLoading(false);setPositionReady(true);setWatchID(position1);setStartPosition({lat:Number(position.coords.latitude.toFixed(2)),lng:Number(position.coords.longitude.toFixed(2)),time:position.timestamp});setCurrentPosition({lat:Number(position.coords.latitude.toFixed(2)),lng:Number(position.coords.longitude.toFixed(2))});setTotalDistance(0);};var watch;var startWatchGPS=function startWatchGPS(){setPositionReady(false);console.log('*** startWatchGPS **** :');watch=Geolocation.watchPosition({},watchsuccess);setWatchID(watch);};var position_1={lat:0,lng:0};var position_2={lat:0,lng:0};var firstwatch=true;var firstcal=true;var sub_distance=0;var watchsuccess=function watchsuccess(position,error){setPositionReady(true);if(firstwatch==true){position_1.lat=startPosition.lat;position_2.lng=startPosition.lng;firstwatch=false;}else{position_1.lat=position_2.lat;position_1.lng=position_2.lng;}position_2.lat=Number(position.coords.latitude.toFixed(2));position_2.lng=Number(position.coords.longitude.toFixed(2));setCurrentPosition({lat:Number(position.coords.latitude.toFixed(2)),lng:Number(position.coords.longitude.toFixed(2))});// setTimeStatus({\n//   stime: startPosition.time,\n//   ftime: position.timestamp\n// });\nconsole.log(\"firstcal :\",firstcal);if(firstcal==false){sub_distance=sub_distance+distanceInKmBetweenEarthCoordinates(position_1,position_2);}setTotalDistance(sub_distance);firstcal=false;};var degreesToRadians=function degreesToRadians(degrees){return degrees*Math.PI/180;};var distanceInKmBetweenEarthCoordinates=function distanceInKmBetweenEarthCoordinates(position1,position2){var earthRadiusKm=6371;var lat1=position1.lat;var lng1=position1.lng;var lat2=position2.lat;var lng2=position2.lng;console.log('lat1 :',lat1,' lng1 :',lng1);console.log('lat2 :',lat2,' lng2 :',lng2);var dLat=degreesToRadians(lat2-lat1);var dLon=degreesToRadians(lng2-lng1);lat1=degreesToRadians(lat1);lat2=degreesToRadians(lat2);var a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.sin(dLon/2)*Math.sin(dLon/2)*Math.cos(lat1)*Math.cos(lat2);var c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));var distancekm=earthRadiusKm*c;var d_round_to_2nd=Number(distancekm.toFixed(2));console.log('distance :',d_round_to_2nd);return d_round_to_2nd;};var stopWatchGPS=function stopWatchGPS(watchid){console.log('watch id :',watchid);var clearwatch=Geolocation.clearWatch(watchid);};/* เพิ่มเลขศูนย์หน้า วัน เดือน เวลา ที่เป็นเลขหลักเดียว */var addZero=function addZero(i){if(i<'10'){i=\"0\"+i;}return i;};var getDatetime=function getDatetime(time){var myDate=new Date(time);var d=addZero(myDate.getDate());var m=addZero(myDate.getMonth()+1);var y=myDate.getFullYear();var h=addZero(myDate.getHours());var min=addZero(myDate.getMinutes());var sec=addZero(myDate.getSeconds());var times=d+'-'+m+'-'+y+' '+h+':'+min+':'+sec;return times;};var durationtime=function durationtime(timestart,timestop){var time=timestop-timestart;var mystartDate=new Date(timestart);var mystopDate=new Date(timestop);var myDate=new Date(time);var h=addZero(myDate.getHours())-7;var min=addZero(myDate.getMinutes());var sec=addZero(myDate.getSeconds());var times;if(h==0){times=min+':'+sec;}else{times=h+':'+min+':'+sec;}return times;};var calduration=function calduration(){var x=durationtime(1453467965439,1585492636444);console.log(x+\" น.\");};var calories=function calories(distance,weight){var cal=(weight*distance*1.036).toFixed(2);console.log(cal+\" Kcal\");return cal;};var calCalories=function calCalories(){var x=calories(308,78);console.log(x+\" Kcal.\");};var stopTextJSX;var distanceTextJSX;var start_time=getDatetime(timeStatus.stime);var current_time=getDatetime(timeStatus.ftime);var duration=durationtime(timeStatus.stime,timeStatus.ftime);if(positionReady==true){stopTextJSX=React.createElement(\"p\",null,\"SLAT = \",startPosition.lat,\" \",React.createElement(\"br\",null),\"LNG = \",startPosition.lng,\" \",React.createElement(\"br\",null),\"Time = \",start_time,\" \",React.createElement(\"br\",null),React.createElement(\"br\",null),\"CLAT = \",currentPosition.lat,\" \",React.createElement(\"br\",null),\"LNG = \",currentPosition.lng,\" \",React.createElement(\"br\",null),\"Time = \",current_time,React.createElement(\"br\",null),React.createElement(\"br\",null),\"WatchGPS_ID = \",watchID,React.createElement(\"br\",null),React.createElement(\"br\",null),\"Dis = \",totalDistance,React.createElement(\"br\",null),\"Duration = \",duration);}else{stopTextJSX=React.createElement(\"p\",null,\"\\u0E01\\u0E14\\u0E1B\\u0E38\\u0E48\\u0E21 StarGetGPS \\u0E40\\u0E1E\\u0E37\\u0E48\\u0E2D\\u0E23\\u0E30\\u0E1A\\u0E38\\u0E1E\\u0E34\\u0E01\\u0E31\\u0E14\\u0E02\\u0E2D\\u0E07\\u0E40\\u0E04\\u0E23\\u0E37\\u0E48\\u0E2D\\u0E07\");}return React.createElement(IonPage,null,React.createElement(IonHeader,{translucent:true},React.createElement(IonToolbar,null,React.createElement(IonButton,{slot:\"start\",color:\"success\",shape:\"round\",size:\"large\",onClick:function onClick(){setTimeStatus({stime:new Date().getTime(),ftime:new Date().getTime()});startWatchGPS();}},\"Start\"),React.createElement(IonButton,{slot:\"end\",color:\"danger\",shape:\"round\",size:\"large\",onClick:function onClick(){setTimeStatus({stime:timeStatus.stime,ftime:new Date().getTime()});stopWatchGPS(watchID);shareValue.duration=duration;console.log('duration',shareValue.duration);shareValue.startTime=start_time;shareValue.stopTime=current_time;shareValue.distance=totalDistance;props.history.push('/tab2');}},\"Stop\"))),React.createElement(IonContent,null,React.createElement(\"body\",null,React.createElement(\"div\",null,stopTextJSX)),React.createElement(IonLoading,{isOpen:showLoading,message:\"\\u0E01\\u0E33\\u0E25\\u0E31\\u0E07\\u0E02\\u0E2D\\u0E1E\\u0E34\\u0E01\\u0E31\\u0E14\"})));};export default Tab3;","map":{"version":3,"sources":["/Users/pratyas/Documents/MobileAppProject/MymobileApp/TOTRun/src/pages/Tab3.tsx"],"names":["React","useState","Plugins","IonPage","IonHeader","IonToolbar","IonButton","IonContent","IonLoading","useIonViewDidEnter","shareValue","Geolocation","Tab3","props","showLoading","setShowLoading","positionReady","setPositionReady","lat","lng","currentPosition","setCurrentPosition","time","startPosition","setStartPosition","stime","ftime","timeStatus","setTimeStatus","totalDistance","setTotalDistance","watchID","setWatchID","startGetGPS","position1","console","log","getCurrentPosition","then","success","catch","error","alert","message","position","Number","coords","latitude","toFixed","longitude","timestamp","watch","startWatchGPS","watchPosition","watchsuccess","position_1","position_2","firstwatch","firstcal","sub_distance","distanceInKmBetweenEarthCoordinates","degreesToRadians","degrees","Math","PI","position2","earthRadiusKm","lat1","lng1","lat2","lng2","dLat","dLon","a","sin","cos","c","atan2","sqrt","distancekm","d_round_to_2nd","stopWatchGPS","watchid","clearwatch","clearWatch","addZero","i","getDatetime","myDate","Date","d","getDate","m","getMonth","y","getFullYear","h","getHours","min","getMinutes","sec","getSeconds","times","durationtime","timestart","timestop","mystartDate","mystopDate","calduration","x","calories","distance","weight","cal","calCalories","stopTextJSX","distanceTextJSX","start_time","current_time","duration","getTime","startTime","stopTime","history","push"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { locate, laptop, time, alarmOutline, star } from \"ionicons/icons\";\r\nimport { Plugins } from \"@capacitor/core\";\r\nimport GoogleMapReact from 'google-map-react';\r\nimport { RefresherEventDetail } from '@ionic/core';\r\nimport { start } from 'repl';\r\nimport { IonPage, IonHeader, IonToolbar, IonTitle, IonButton, IonIcon, IonButtons, IonContent, IonLoading, useIonViewDidEnter } from '@ionic/react';\r\nimport { RouteComponentProps, useHistory } from 'react-router';\r\nimport { strict } from 'assert';\r\nimport shareValue from \"../Models/share\";\r\nimport { get } from 'https';\r\n\r\n\r\nconst { Geolocation } = Plugins;\r\nconst Tab3: React.FC<RouteComponentProps> = (props) => {\r\n  const [showLoading, setShowLoading] = useState(false);\r\n  const [positionReady, setPositionReady] = useState(false);\r\n  const [currentPosition, setCurrentPosition] = useState({ lat: 0, lng: 0 });\r\n  const [startPosition, setStartPosition] = useState({ lat: 0, lng: 0, time: 0 });\r\n  const [timeStatus, setTimeStatus] = useState({ stime: 0, ftime: 0 });\r\n  const [totalDistance, setTotalDistance] = useState(0);\r\n  const [watchID, setWatchID] = useState(0);\r\n\r\n\r\n  useIonViewDidEnter(() => {\r\n    startGetGPS();\r\n  });\r\n\r\n  let position1: any;\r\n  const startGetGPS = async () => {\r\n    console.log('**** startGetGPS ***');\r\n    setShowLoading(false)\r\n    let position1 = await Geolocation.getCurrentPosition().then(success)\r\n      .catch((error) => {\r\n        alert('Not found Position:' + error.message);\r\n      });\r\n  }\r\n\r\n  let success = (position: any) => {\r\n    setShowLoading(false);\r\n    setPositionReady(true);\r\n    setWatchID(position1);\r\n    setStartPosition({\r\n      lat: Number(position.coords.latitude.toFixed(2)),\r\n      lng: Number(position.coords.longitude.toFixed(2)),\r\n      time: position.timestamp\r\n    });\r\n    setCurrentPosition({\r\n      lat: Number(position.coords.latitude.toFixed(2)),\r\n      lng: Number(position.coords.longitude.toFixed(2))\r\n    });\r\n\r\n    setTotalDistance(0);\r\n\r\n\r\n  }\r\n\r\n  let watch: any;\r\n\r\n  let startWatchGPS = () => {\r\n    setPositionReady(false);\r\n    console.log('*** startWatchGPS **** :');\r\n    watch = Geolocation.watchPosition({}, (watchsuccess));\r\n    setWatchID(watch);\r\n  }\r\n  let position_1 = { lat: 0, lng: 0 }\r\n  let position_2 = { lat: 0, lng: 0 }\r\n  let firstwatch = true;\r\n  let firstcal = true;\r\n  let sub_distance = 0;\r\n\r\n  let watchsuccess = (position: any, error: any) => {\r\n    setPositionReady(true);\r\n    if (firstwatch == true) {\r\n      position_1.lat = startPosition.lat;\r\n      position_2.lng = startPosition.lng;\r\n      firstwatch = false;\r\n    }\r\n    else {\r\n      position_1.lat = position_2.lat;\r\n      position_1.lng = position_2.lng;\r\n    }\r\n    position_2.lat = Number(position.coords.latitude.toFixed(2));\r\n    position_2.lng = Number(position.coords.longitude.toFixed(2));\r\n\r\n    setCurrentPosition({\r\n      lat: Number(position.coords.latitude.toFixed(2)),\r\n      lng: Number(position.coords.longitude.toFixed(2))\r\n    });\r\n    // setTimeStatus({\r\n    //   stime: startPosition.time,\r\n    //   ftime: position.timestamp\r\n    // });\r\n    console.log(\"firstcal :\", firstcal);\r\n    if (firstcal == false) {\r\n      sub_distance = sub_distance + distanceInKmBetweenEarthCoordinates(position_1, position_2);\r\n    }\r\n    setTotalDistance(sub_distance);\r\n\r\n    firstcal = false;\r\n  }\r\n\r\n  let degreesToRadians = (degrees: any) => {\r\n    return degrees * Math.PI / 180;\r\n  }\r\n\r\n  let distanceInKmBetweenEarthCoordinates = (position1: any, position2: any) => {\r\n    var earthRadiusKm = 6371;\r\n    let lat1 = position1.lat;\r\n    let lng1 = position1.lng;\r\n    let lat2 = position2.lat;\r\n    let lng2 = position2.lng;\r\n    console.log('lat1 :', lat1, ' lng1 :', lng1);\r\n    console.log('lat2 :', lat2, ' lng2 :', lng2);\r\n    var dLat = degreesToRadians(lat2 - lat1);\r\n    var dLon = degreesToRadians(lng2 - lng1);\r\n\r\n    lat1 = degreesToRadians(lat1);\r\n    lat2 = degreesToRadians(lat2);\r\n    var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n      Math.sin(dLon / 2) * Math.sin(dLon / 2) * Math.cos(lat1) * Math.cos(lat2);\r\n    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n    let distancekm = earthRadiusKm * c;\r\n    let d_round_to_2nd = Number(distancekm.toFixed(2));\r\n    console.log('distance :', d_round_to_2nd);\r\n    return d_round_to_2nd;\r\n  }\r\n\r\n\r\n\r\n  let stopWatchGPS = (watchid: any) => {\r\n    console.log('watch id :', watchid);\r\n    let clearwatch = Geolocation.clearWatch(watchid);\r\n  }\r\n\r\n\r\n\r\n  /* เพิ่มเลขศูนย์หน้า วัน เดือน เวลา ที่เป็นเลขหลักเดียว */\r\n  let addZero = (i: any) => {\r\n    if (i < '10') {\r\n      i = \"0\" + i;\r\n    }\r\n    return i;\r\n  }\r\n\r\n  let getDatetime = (time: any) => {\r\n    let myDate = new Date(time);\r\n    let d = addZero(myDate.getDate());\r\n    let m = addZero((myDate.getMonth()) + 1);\r\n    let y = myDate.getFullYear();\r\n    let h = addZero(myDate.getHours());\r\n    let min = addZero(myDate.getMinutes());\r\n    let sec = addZero(myDate.getSeconds());\r\n    let times = d + '-' + m + '-' + y + ' ' + h + ':' + min + ':' + sec\r\n    return times;\r\n  };\r\n\r\n  let durationtime = (timestart: any, timestop: any) => {\r\n    let time = timestop - timestart;\r\n    let mystartDate = new Date(timestart);\r\n    let mystopDate = new Date(timestop);\r\n    let myDate = new Date(time);\r\n    let h = addZero(myDate.getHours()) - 7;\r\n    let min = addZero(myDate.getMinutes());\r\n    let sec = addZero(myDate.getSeconds());\r\n    let times;\r\n    if (h == 0) {\r\n      times = min + ':' + sec\r\n    } else {\r\n      times = h + ':' + min + ':' + sec\r\n    }\r\n    return times;\r\n  };\r\n\r\n  let calduration = () => {\r\n    let x = durationtime(1453467965439, 1585492636444);\r\n    console.log(x + \" น.\")\r\n  }\r\n\r\n  let calories = (distance: any, weight: any) => {\r\n\r\n    let cal = (weight * distance * 1.036).toFixed(2)\r\n    console.log(cal + \" Kcal\")\r\n    return cal;\r\n\r\n  };\r\n  let calCalories = () => {\r\n    let x = calories(308, 78);\r\n    console.log(x + \" Kcal.\")\r\n  }\r\n\r\n\r\n  let stopTextJSX;\r\n  let distanceTextJSX;\r\n  let start_time = getDatetime(timeStatus.stime);\r\n  let current_time = getDatetime(timeStatus.ftime);\r\n  let duration = durationtime(timeStatus.stime, timeStatus.ftime);\r\n\r\n  if (positionReady == true) {\r\n    stopTextJSX = <p>\r\n      SLAT = {startPosition.lat} <br></br>\r\n      LNG = {startPosition.lng} <br></br>\r\n      Time = {start_time} <br></br>\r\n      <br></br>\r\n      CLAT = {currentPosition.lat} <br></br>\r\n      LNG = {currentPosition.lng} <br></br>\r\n      Time = {current_time}<br></br>\r\n      <br></br>\r\n      WatchGPS_ID = {watchID}<br></br>\r\n      <br></br>\r\n      Dis = {totalDistance}<br></br>\r\n      Duration = {duration}\r\n    </p>\r\n  } else {\r\n    stopTextJSX = <p>กดปุ่ม StarGetGPS เพื่อระบุพิกัดของเครื่อง</p>\r\n  }\r\n\r\n  return (\r\n    <IonPage>\r\n      <IonHeader translucent={true}>\r\n        <IonToolbar>\r\n          <IonButton slot=\"start\" color=\"success\" shape=\"round\" size=\"large\" onClick={() => {\r\n            setTimeStatus({\r\n              stime: new Date().getTime(),\r\n              ftime: new Date().getTime()\r\n            });\r\n            startWatchGPS();\r\n          }} >Start</IonButton>\r\n          <IonButton slot=\"end\" color=\"danger\" shape=\"round\" size=\"large\" onClick={() => {\r\n            setTimeStatus({\r\n              stime: timeStatus.stime,\r\n              ftime: new Date().getTime()\r\n            });\r\n            stopWatchGPS(watchID)\r\n            shareValue.duration = duration;\r\n            console.log('duration', shareValue.duration);\r\n            shareValue.startTime = start_time;\r\n            shareValue.stopTime = current_time;\r\n            shareValue.distance = totalDistance;\r\n            props.history.push('/tab2');\r\n          }}>Stop</IonButton>\r\n        </IonToolbar>\r\n      </IonHeader>\r\n      <IonContent>\r\n        <body >\r\n          <div>\r\n            {stopTextJSX}\r\n          </div>\r\n        </body>\r\n        <IonLoading isOpen={showLoading} message=\"กำลังขอพิกัด\" />\r\n      </IonContent>\r\n    </IonPage>\r\n  );\r\n};\r\nexport default Tab3;"]},"metadata":{},"sourceType":"module"}