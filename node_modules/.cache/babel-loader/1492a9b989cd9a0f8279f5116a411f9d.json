{"ast":null,"code":"var _jsxFileName = \"/Users/pratyas/Documents/MobileAppProject/MymobileApp/TOTRun/src/pages/Tab3.tsx\";\nimport React, { useState } from 'react';\nimport { Plugins } from \"@capacitor/core\";\nimport { IonPage, IonHeader, IonToolbar, IonButton, IonContent, IonLoading, useIonViewDidEnter } from '@ionic/react';\nimport shareValue from \"../Models/share\";\nconst {\n  Geolocation\n} = Plugins;\n\nconst Tab3 = props => {\n  const [showLoading, setShowLoading] = useState(false);\n  const [positionReady, setPositionReady] = useState(false);\n  const [currentPosition, setCurrentPosition] = useState({\n    lat: 0,\n    lng: 0\n  });\n  const [startPosition, setStartPosition] = useState({\n    lat: 0,\n    lng: 0,\n    time: 0\n  });\n  const [timeStatus, setTimeStatus] = useState({\n    stime: 0,\n    ftime: 0\n  });\n  const [totalDistance, setTotalDistance] = useState(0);\n  const [watchID, setWatchID] = useState(0);\n  useIonViewDidEnter(() => {\n    startGetGPS();\n  });\n  let position1;\n\n  const startGetGPS = async () => {\n    console.log('**** startGetGPS ***');\n    setShowLoading(false);\n    let position1 = await Geolocation.getCurrentPosition().then(success).catch(error => {\n      alert('Not found Position:' + error.message);\n    });\n  };\n\n  let success = position => {\n    setShowLoading(false);\n    setPositionReady(true);\n    setWatchID(position1);\n    setStartPosition({\n      lat: position.coords.latitude,\n      lng: position.coords.longitude,\n      time: position.timestamp\n    });\n    setCurrentPosition({\n      lat: position.coords.latitude,\n      lng: position.coords.longitude\n    });\n    setTotalDistance(0);\n  };\n\n  let watch;\n\n  let startWatchGPS = () => {\n    console.log('*** startWatchGPS **** :');\n    watch = Geolocation.watchPosition({\n      enableHighAccuracy: true,\n      timeout: 5000\n    }, watchsuccess);\n    setWatchID(watch);\n  };\n\n  let position_1 = {\n    lat: 0,\n    lng: 0\n  };\n  let position_2 = {\n    lat: 0,\n    lng: 0\n  };\n  let firstwatch = true;\n  let firstcal = true;\n  let sub_distance = 0;\n\n  let watchsuccess = (position, error) => {\n    setPositionReady(true);\n\n    if (firstwatch == true) {\n      setStartPosition({\n        lat: position.coords.latitude,\n        lng: position.coords.longitude,\n        time: position.timestamp\n      });\n      position_1.lat = position.coords.latitude;\n      position_2.lng = position.coords.longitude;\n      firstwatch = false;\n    } else {\n      position_1.lat = position_2.lat;\n      position_1.lng = position_2.lng;\n    }\n\n    setCurrentPosition({\n      lat: position.coords.latitude,\n      lng: position.coords.longitude\n    });\n    position_2.lat = position.coords.latitude;\n    position_2.lng = position.coords.longitude;\n    console.log(\"firstcal :\", firstcal);\n\n    if (firstcal == false) {\n      sub_distance = sub_distance + distanceInKmBetweenEarthCoordinates(position_1, position_2);\n    }\n\n    console.log('Subdistance :', sub_distance);\n    setTotalDistance(Number(sub_distance.toFixed(2)));\n    firstcal = false;\n  };\n\n  let degreesToRadians = degrees => {\n    return degrees * Math.PI / 180;\n  };\n\n  let distanceInKmBetweenEarthCoordinates = (position1, position2) => {\n    let Significant = 2;\n    let earthRadiusKm = 6371;\n    let lat1 = Number(position1.lat.toFixed(Significant));\n    let lng1 = Number(position1.lng.toFixed(Significant));\n    let lat2 = Number(position2.lat.toFixed(Significant));\n    let lng2 = Number(position2.lng.toFixed(Significant));\n    console.log('lat1 :', lat1, ' lng1 :', lng1);\n    console.log('lat2 :', lat2, ' lng2 :', lng2);\n    let dLat = degreesToRadians(lat2 - lat1);\n    let dLon = degreesToRadians(lng2 - lng1);\n    lat1 = degreesToRadians(lat1);\n    lat2 = degreesToRadians(lat2);\n    let a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.sin(dLon / 2) * Math.sin(dLon / 2) * Math.cos(lat1) * Math.cos(lat2);\n    let c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    let distancekm = earthRadiusKm * c;\n    return Number(distancekm.toFixed(2));\n  };\n\n  let stopWatchGPS = watchid => {\n    console.log('watch id :', watchid);\n    let clearwatch = Geolocation.clearWatch(watchid);\n  };\n  /* เพิ่มเลขศูนย์หน้า วัน เดือน เวลา ที่เป็นเลขหลักเดียว */\n\n\n  let addZero = i => {\n    if (i < '10') {\n      i = \"0\" + i;\n    }\n\n    return i;\n  };\n\n  let getDatetime = time => {\n    let myDate = new Date(time);\n    let d = addZero(myDate.getDate());\n    let m = addZero(myDate.getMonth() + 1);\n    let y = myDate.getFullYear();\n    let h = addZero(myDate.getHours());\n    let min = addZero(myDate.getMinutes());\n    let sec = addZero(myDate.getSeconds());\n    let times = d + '-' + m + '-' + y + ' ' + h + ':' + min + ':' + sec;\n    return times;\n  };\n\n  let durationtime = (timestart, timestop) => {\n    let time = timestop - timestart;\n    let mystartDate = new Date(timestart);\n    let mystopDate = new Date(timestop);\n    let myDate = new Date(time);\n    let h = addZero(myDate.getHours()) - 7;\n    let min = addZero(myDate.getMinutes());\n    let sec = addZero(myDate.getSeconds());\n    let times;\n\n    if (h == 0) {\n      times = min + ':' + sec;\n    } else {\n      times = h + ':' + min + ':' + sec;\n    }\n\n    return times;\n  };\n\n  let calduration = () => {\n    let x = durationtime(1453467965439, 1585492636444);\n    console.log(x + \" น.\");\n  };\n\n  let calories = (distance, weight) => {\n    let cal = (weight * distance * 1.036).toFixed(2);\n    console.log(cal + \" Kcal\");\n    return cal;\n  };\n\n  let calCalories = () => {\n    let x = calories(308, 78);\n    console.log(x + \" Kcal.\");\n  };\n\n  let stopTextJSX;\n  let distanceTextJSX;\n  let start_time = getDatetime(timeStatus.stime);\n  let current_time = getDatetime(timeStatus.ftime);\n  let duration = durationtime(timeStatus.stime, timeStatus.ftime);\n\n  if (positionReady == true) {\n    stopTextJSX = React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204\n      },\n      __self: this\n    }, \"SLAT = \", startPosition.lat, \" \", React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205\n      },\n      __self: this\n    }), \"LNG = \", startPosition.lng, \" \", React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206\n      },\n      __self: this\n    }), \"Time = \", start_time, \" \", React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 207\n      },\n      __self: this\n    }), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208\n      },\n      __self: this\n    }), \"CLAT = \", currentPosition.lat, \" \", React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209\n      },\n      __self: this\n    }), \"LNG = \", currentPosition.lng, \" \", React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210\n      },\n      __self: this\n    }), \"Time = \", current_time, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211\n      },\n      __self: this\n    }), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212\n      },\n      __self: this\n    }), \"WatchGPS_ID = \", watchID, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213\n      },\n      __self: this\n    }), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214\n      },\n      __self: this\n    }), \"Dis = \", totalDistance, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215\n      },\n      __self: this\n    }), \"Duration = \", duration);\n  }\n\n  return React.createElement(IonPage, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221\n    },\n    __self: this\n  }, React.createElement(IonHeader, {\n    translucent: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222\n    },\n    __self: this\n  }, React.createElement(IonToolbar, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223\n    },\n    __self: this\n  }, React.createElement(IonButton, {\n    slot: \"start\",\n    color: \"success\",\n    shape: \"round\",\n    size: \"large\",\n    onClick: () => {\n      setTimeStatus({\n        stime: new Date().getTime(),\n        ftime: new Date().getTime()\n      });\n      startWatchGPS();\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224\n    },\n    __self: this\n  }, \"Start\"), React.createElement(IonButton, {\n    color: \"danger\",\n    shape: \"round\",\n    size: \"large\",\n    onClick: () => {\n      setTimeStatus({\n        stime: timeStatus.stime,\n        ftime: new Date().getTime()\n      });\n      stopWatchGPS(watchID);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231\n    },\n    __self: this\n  }, \"Stop\"), React.createElement(IonButton, {\n    slot: \"end\",\n    color: \"primary\",\n    shape: \"round\",\n    size: \"large\",\n    onClick: () => {\n      shareValue.duration = duration;\n      console.log('duration', shareValue.duration);\n      shareValue.startTime = start_time;\n      shareValue.stopTime = current_time;\n      shareValue.distance = totalDistance;\n      props.history.push('/tab2');\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238\n    },\n    __self: this\n  }, \"Next\"))), React.createElement(IonContent, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 248\n    },\n    __self: this\n  }, React.createElement(\"body\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 249\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250\n    },\n    __self: this\n  }, stopTextJSX)), React.createElement(IonLoading, {\n    isOpen: showLoading,\n    message: \"\\u0E01\\u0E33\\u0E25\\u0E31\\u0E07\\u0E02\\u0E2D\\u0E1E\\u0E34\\u0E01\\u0E31\\u0E14\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 254\n    },\n    __self: this\n  })));\n};\n\nexport default Tab3;","map":{"version":3,"sources":["/Users/pratyas/Documents/MobileAppProject/MymobileApp/TOTRun/src/pages/Tab3.tsx"],"names":["React","useState","Plugins","IonPage","IonHeader","IonToolbar","IonButton","IonContent","IonLoading","useIonViewDidEnter","shareValue","Geolocation","Tab3","props","showLoading","setShowLoading","positionReady","setPositionReady","currentPosition","setCurrentPosition","lat","lng","startPosition","setStartPosition","time","timeStatus","setTimeStatus","stime","ftime","totalDistance","setTotalDistance","watchID","setWatchID","startGetGPS","position1","console","log","getCurrentPosition","then","success","catch","error","alert","message","position","coords","latitude","longitude","timestamp","watch","startWatchGPS","watchPosition","enableHighAccuracy","timeout","watchsuccess","position_1","position_2","firstwatch","firstcal","sub_distance","distanceInKmBetweenEarthCoordinates","Number","toFixed","degreesToRadians","degrees","Math","PI","position2","Significant","earthRadiusKm","lat1","lng1","lat2","lng2","dLat","dLon","a","sin","cos","c","atan2","sqrt","distancekm","stopWatchGPS","watchid","clearwatch","clearWatch","addZero","i","getDatetime","myDate","Date","d","getDate","m","getMonth","y","getFullYear","h","getHours","min","getMinutes","sec","getSeconds","times","durationtime","timestart","timestop","mystartDate","mystopDate","calduration","x","calories","distance","weight","cal","calCalories","stopTextJSX","distanceTextJSX","start_time","current_time","duration","getTime","startTime","stopTime","history","push"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { locate, laptop, time, alarmOutline, star } from \"ionicons/icons\";\r\nimport { Plugins } from \"@capacitor/core\";\r\nimport GoogleMapReact from 'google-map-react';\r\nimport { RefresherEventDetail } from '@ionic/core';\r\nimport { start } from 'repl';\r\nimport { IonPage, IonHeader, IonToolbar, IonTitle, IonButton, IonIcon, IonButtons, IonContent, IonLoading, useIonViewDidEnter } from '@ionic/react';\r\nimport { RouteComponentProps, useHistory } from 'react-router';\r\nimport { strict } from 'assert';\r\nimport shareValue from \"../Models/share\";\r\nimport { get } from 'https';\r\n\r\n\r\nconst { Geolocation } = Plugins;\r\nconst Tab3: React.FC<RouteComponentProps> = (props) => {\r\n  const [showLoading, setShowLoading] = useState(false);\r\n  const [positionReady, setPositionReady] = useState(false);\r\n  const [currentPosition, setCurrentPosition] = useState({ lat: 0, lng: 0 });\r\n  const [startPosition, setStartPosition] = useState({ lat: 0, lng: 0, time: 0 });\r\n  const [timeStatus, setTimeStatus] = useState({ stime: 0, ftime: 0 });\r\n  const [totalDistance, setTotalDistance] = useState(0);\r\n  const [watchID, setWatchID] = useState(0);\r\n\r\n\r\n  useIonViewDidEnter(() => {\r\n    startGetGPS();\r\n  });\r\n\r\n  let position1: any;\r\n  const startGetGPS = async () => {\r\n    console.log('**** startGetGPS ***');\r\n    setShowLoading(false)\r\n    let position1 = await Geolocation.getCurrentPosition().then(success)\r\n      .catch((error) => {\r\n        alert('Not found Position:' + error.message);\r\n      });\r\n  }\r\n\r\n  let success = (position: any) => {\r\n    setShowLoading(false);\r\n    setPositionReady(true);\r\n    setWatchID(position1);\r\n    setStartPosition({\r\n      lat: position.coords.latitude,\r\n      lng: position.coords.longitude,\r\n      time: position.timestamp\r\n    });\r\n    setCurrentPosition({\r\n      lat: position.coords.latitude,\r\n      lng: position.coords.longitude\r\n    });\r\n\r\n    setTotalDistance(0);\r\n\r\n\r\n  }\r\n\r\n  let watch: any;\r\n\r\n  let startWatchGPS = () => {\r\n    \r\n    console.log('*** startWatchGPS **** :');\r\n    watch = Geolocation.watchPosition({enableHighAccuracy:true,timeout:5000}, (watchsuccess));\r\n    setWatchID(watch);\r\n  }\r\n  let position_1 = { lat: 0, lng: 0 }\r\n  let position_2 = { lat: 0, lng: 0 }\r\n  let firstwatch = true;\r\n  let firstcal = true;\r\n  let sub_distance = 0;\r\n\r\n  let watchsuccess = (position: any, error: any) => {\r\n    setPositionReady(true);\r\n    if (firstwatch == true) {\r\n      setStartPosition({\r\n        lat: position.coords.latitude,\r\n        lng: position.coords.longitude,\r\n        time: position.timestamp\r\n      });\r\n      position_1.lat = position.coords.latitude;\r\n      position_2.lng = position.coords.longitude;\r\n      firstwatch = false;\r\n    }\r\n    else {\r\n      position_1.lat = position_2.lat;\r\n      position_1.lng = position_2.lng;\r\n    }\r\n    setCurrentPosition({\r\n      lat: position.coords.latitude,\r\n      lng: position.coords.longitude\r\n    });\r\n    position_2.lat = position.coords.latitude;\r\n    position_2.lng = position.coords.longitude;\r\n\r\n    \r\n    \r\n    console.log(\"firstcal :\", firstcal);\r\n    if (firstcal == false) {\r\n      sub_distance = sub_distance + distanceInKmBetweenEarthCoordinates(position_1, position_2);\r\n    }\r\n    console.log('Subdistance :',sub_distance);\r\n    setTotalDistance(Number(sub_distance.toFixed(2)));\r\n\r\n    firstcal = false;\r\n  }\r\n\r\n  let degreesToRadians = (degrees: any) => {\r\n    return degrees * Math.PI / 180;\r\n  }\r\n\r\n  let distanceInKmBetweenEarthCoordinates = (position1: any, position2: any) => {\r\n    let Significant = 2;\r\n    let earthRadiusKm = 6371;\r\n    let lat1 = Number((position1.lat).toFixed(Significant));\r\n    let lng1 = Number((position1.lng).toFixed(Significant));\r\n    let lat2 = Number((position2.lat).toFixed(Significant));\r\n    let lng2 = Number((position2.lng).toFixed(Significant));\r\n    console.log('lat1 :', lat1, ' lng1 :', lng1);\r\n    console.log('lat2 :', lat2, ' lng2 :', lng2);\r\n    let dLat = degreesToRadians(lat2 - lat1);\r\n    let dLon = degreesToRadians(lng2 - lng1);\r\n\r\n    lat1 = degreesToRadians(lat1);\r\n    lat2 = degreesToRadians(lat2);\r\n    let a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n      Math.sin(dLon / 2) * Math.sin(dLon / 2) * Math.cos(lat1) * Math.cos(lat2);\r\n    let c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n    let distancekm = earthRadiusKm * c;\r\n    \r\n    return Number(distancekm.toFixed(2));\r\n  }\r\n\r\n\r\n\r\n  let stopWatchGPS = (watchid: any) => {\r\n    console.log('watch id :', watchid);\r\n    let clearwatch = Geolocation.clearWatch(watchid);\r\n  }\r\n\r\n\r\n\r\n  /* เพิ่มเลขศูนย์หน้า วัน เดือน เวลา ที่เป็นเลขหลักเดียว */\r\n  let addZero = (i: any) => {\r\n    if (i < '10') {\r\n      i = \"0\" + i;\r\n    }\r\n    return i;\r\n  }\r\n\r\n  let getDatetime = (time: any) => {\r\n    let myDate = new Date(time);\r\n    let d = addZero(myDate.getDate());\r\n    let m = addZero((myDate.getMonth()) + 1);\r\n    let y = myDate.getFullYear();\r\n    let h = addZero(myDate.getHours());\r\n    let min = addZero(myDate.getMinutes());\r\n    let sec = addZero(myDate.getSeconds());\r\n    let times = d + '-' + m + '-' + y + ' ' + h + ':' + min + ':' + sec\r\n    return times;\r\n  };\r\n\r\n  let durationtime = (timestart: any, timestop: any) => {\r\n    let time = timestop - timestart;\r\n    let mystartDate = new Date(timestart);\r\n    let mystopDate = new Date(timestop);\r\n    let myDate = new Date(time);\r\n    let h = addZero(myDate.getHours()) - 7;\r\n    let min = addZero(myDate.getMinutes());\r\n    let sec = addZero(myDate.getSeconds());\r\n    let times;\r\n    if (h == 0) {\r\n      times = min + ':' + sec\r\n    } else {\r\n      times = h + ':' + min + ':' + sec\r\n    }\r\n    return times;\r\n  };\r\n\r\n  let calduration = () => {\r\n    let x = durationtime(1453467965439, 1585492636444);\r\n    console.log(x + \" น.\")\r\n  }\r\n\r\n  let calories = (distance: any, weight: any) => {\r\n\r\n    let cal = (weight * distance * 1.036).toFixed(2)\r\n    console.log(cal + \" Kcal\")\r\n    return cal;\r\n\r\n  };\r\n  let calCalories = () => {\r\n    let x = calories(308, 78);\r\n    console.log(x + \" Kcal.\")\r\n  }\r\n\r\n\r\n  let stopTextJSX;\r\n  let distanceTextJSX;\r\n  let start_time = getDatetime(timeStatus.stime);\r\n  let current_time = getDatetime(timeStatus.ftime);\r\n  let duration = durationtime(timeStatus.stime, timeStatus.ftime);\r\n\r\n  if (positionReady == true) {\r\n    stopTextJSX = <p>\r\n      SLAT = {startPosition.lat} <br></br>\r\n      LNG = {startPosition.lng} <br></br>\r\n      Time = {start_time} <br></br>\r\n      <br></br>\r\n      CLAT = {currentPosition.lat} <br></br>\r\n      LNG = {currentPosition.lng} <br></br>\r\n      Time = {current_time}<br></br>\r\n      <br></br>\r\n      WatchGPS_ID = {watchID}<br></br>\r\n      <br></br>\r\n      Dis = {totalDistance}<br></br>\r\n      Duration = {duration}\r\n    </p>\r\n  } \r\n\r\n  return (\r\n    <IonPage>\r\n      <IonHeader translucent={true}>\r\n        <IonToolbar>\r\n          <IonButton slot=\"start\" color=\"success\" shape=\"round\" size=\"large\" onClick={() => {\r\n            setTimeStatus({\r\n              stime: new Date().getTime(),\r\n              ftime: new Date().getTime()\r\n            });\r\n            startWatchGPS();\r\n          }} >Start</IonButton>\r\n          <IonButton color=\"danger\" shape=\"round\" size=\"large\" onClick={() => {\r\n            setTimeStatus({\r\n              stime: timeStatus.stime,\r\n              ftime: new Date().getTime()\r\n            });\r\n            stopWatchGPS(watchID)\r\n          }}>Stop</IonButton>\r\n          <IonButton slot=\"end\" color=\"primary\" shape=\"round\" size=\"large\" onClick={() => {\r\n            shareValue.duration = duration;\r\n            console.log('duration', shareValue.duration);\r\n            shareValue.startTime = start_time;\r\n            shareValue.stopTime = current_time;\r\n            shareValue.distance = totalDistance;\r\n            props.history.push('/tab2');\r\n          }}>Next</IonButton>\r\n        </IonToolbar>\r\n      </IonHeader>\r\n      <IonContent>\r\n        <body >\r\n          <div>\r\n            {stopTextJSX}\r\n          </div>\r\n        </body>\r\n        <IonLoading isOpen={showLoading} message=\"กำลังขอพิกัด\" />\r\n      </IonContent>\r\n    </IonPage>\r\n  );\r\n};\r\nexport default Tab3;"]},"metadata":{},"sourceType":"module"}